#!/usr/bin/perl


my $ps_result;


sub which_program
{
    open(PS_PROC,"ps x |") or die "can't exec ps ! suxor system !\n";

    while(<PS_PROC>)
    {
	if(/amule/)
	{
	    close(PS_PROC);
	    return "amule";
	}
	elsif(/xmule/)
	{
	    close(PS_PROC);
	    return "xmule";
	}
    }
    return "nobody";
}

sub main
{
    my $program;
    my $url;

    $url=@ARGV[0];
    $program=which_program();
    print "url : $url \n";
    if($program=~/nobody/){
	exit(-1);
    }
    elsif($program=~/amule/)
    {
	if(-x "/usr/bin/ed2k.amule")
	{
	    system("/usr/bin/ed2k.amule" , $url);
	    print "add an amule ed2k link\n";
	}
	else
	{
	    print "oOops ! In cant exec /usr/bin/ed2k.amule";
	}
    }
    elsif($program=~/xmule/)
    {
	if (-x "/usr/bin/ed2k.xmule")
	{
	    system("/usr/bin/ed2k.xmule '".$url."'");
	    print "add an xmule ed2k link\n";
	}
	else
	{
	    print "OoOps ! couldn't find /usr/bin/ed2k binary !\n"
	}
    }
}

&main();
